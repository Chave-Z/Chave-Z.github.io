<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Nginx基础 | D丶Cheng的博客</title><meta name="description" content="安装yum方式 这个比较简单，一步到位  先安装依赖1yum -y install gcc zlib zlib-devel pcre-devel openssl openssl-devel  安装nginx1234567&gt; yum install nginx # 安装# 安装完毕以后 可以使用如下常用命令nginx -v # 查看版本nginx -t # 检查语法nginx -s reloa"><meta name="keywords" content="nginx"><meta name="author" content="D丶Cheng"><meta name="copyright" content="D丶Cheng"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://chave-z.github.io/posts/a477be03.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="Nginx基础"><meta property="og:url" content="https://chave-z.github.io/posts/a477be03.html"><meta property="og:site_name" content="D丶Cheng的博客"><meta property="og:description" content="安装yum方式 这个比较简单，一步到位  先安装依赖1yum -y install gcc zlib zlib-devel pcre-devel openssl openssl-devel  安装nginx1234567&gt; yum install nginx # 安装# 安装完毕以后 可以使用如下常用命令nginx -v # 查看版本nginx -t # 检查语法nginx -s reloa"><meta property="og:image" content="https://chave-z.github.io/null"><meta property="article:published_time" content="2021-01-22T04:00:00.000Z"><meta property="article:modified_time" content="2022-12-06T06:02:17.644Z"><meta name="twitter:card" content="summary"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '5.1.1',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime: '天',
  date_suffix: {"one_hour":"刚刚","hours":"小时前","day":"天前"},
  copyright: {"limitCount":50,"languages":{"author":"作者: D丶Cheng","link":"链接: ","source":"来源: D丶Cheng的博客","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
    },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2022-12-06 14:02:17'
}</script><noscript><style type="text/css">
#nav {
  opacity: 1
}
.justified-gallery img {
  opacity: 1
}
</style></noscript><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
  }
}

var autoChangeMode = 'false'
var t = saveToLocal.get('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (saveToLocal.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><meta name="generator" content="Hexo 5.1.1"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/null" onerror="onerror=null;src='https://cdn.staticaly.com/gh/Chave-Z/picture@master/data/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">93</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">17</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">17</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 所有文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div id="body-wrap"><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">1.</span> <span class="toc-text">安装</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#yum%E6%96%B9%E5%BC%8F"><span class="toc-number">1.1.</span> <span class="toc-text">yum方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%88%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96"><span class="toc-number">1.1.1.</span> <span class="toc-text">先安装依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85nginx"><span class="toc-number">1.1.2.</span> <span class="toc-text">安装nginx</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E8%A1%8C%E5%AE%89%E8%A3%85%E6%96%B9%E5%BC%8F"><span class="toc-number">1.2.</span> <span class="toc-text">自行安装方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E6%96%B9%E5%BC%8F%E5%8C%BA%E5%88%AB"><span class="toc-number">1.3.</span> <span class="toc-text">安装方式区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98%E9%97%AE%E9%A2%98"><span class="toc-number">1.4.</span> <span class="toc-text">遇到的问题问题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#nginx-conf%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3"><span class="toc-number">2.</span> <span class="toc-text">nginx.conf核心配置文件详解</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E5%9D%97"><span class="toc-number">2.1.</span> <span class="toc-text">全局块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#user"><span class="toc-number">2.1.1.</span> <span class="toc-text">user</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#worker-processes"><span class="toc-number">2.1.2.</span> <span class="toc-text">worker_processes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E7%BA%A7%E5%88%AB"><span class="toc-number">2.1.3.</span> <span class="toc-text">日志级别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pid"><span class="toc-number">2.1.4.</span> <span class="toc-text">pid</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#events%E6%A8%A1%E5%9D%97"><span class="toc-number">2.2.</span> <span class="toc-text">events模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#http%E6%8C%87%E4%BB%A4%E5%9D%97"><span class="toc-number">2.3.</span> <span class="toc-text">http指令块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#http%E7%9B%B4%E5%B1%9E%E9%85%8D%E7%BD%AE"><span class="toc-number">2.3.1.</span> <span class="toc-text">http直属配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#include"><span class="toc-number">2.3.1.1.</span> <span class="toc-text">include</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#log-format"><span class="toc-number">2.3.1.2.</span> <span class="toc-text">log_format</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sendfile%E5%92%8Ctcp-nopush"><span class="toc-number">2.3.1.3.</span> <span class="toc-text">sendfile和tcp_nopush</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#keepalive-timeout"><span class="toc-number">2.3.1.4.</span> <span class="toc-text">keepalive_timeout</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gzip"><span class="toc-number">2.3.1.5.</span> <span class="toc-text">gzip</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#server%E6%A8%A1%E5%9D%97"><span class="toc-number">2.3.2.</span> <span class="toc-text">server模块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#location%E6%A8%A1%E5%9D%97"><span class="toc-number">2.3.2.1.</span> <span class="toc-text">location模块</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#root%E5%92%8Calias%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">2.3.2.1.1.</span> <span class="toc-text">root和alias的区别</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#location%E7%9A%84%E5%8C%B9%E9%85%8D%E8%A7%84%E5%88%99"><span class="toc-number">2.3.2.1.2.</span> <span class="toc-text">location的匹配规则</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#upstream"><span class="toc-number">2.3.2.2.</span> <span class="toc-text">upstream</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#max-conns"><span class="toc-number">2.3.2.2.1.</span> <span class="toc-text">max_conns</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#slow-start-%E4%BB%98%E8%B4%B9%E5%8A%9F%E8%83%BD"><span class="toc-number">2.3.2.2.2.</span> <span class="toc-text">slow_start(付费功能)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#down"><span class="toc-number">2.3.2.2.3.</span> <span class="toc-text">down</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#backup"><span class="toc-number">2.3.2.2.4.</span> <span class="toc-text">backup</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#keepalive"><span class="toc-number">2.3.2.2.5.</span> <span class="toc-text">keepalive</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-number">2.3.2.2.6.</span> <span class="toc-text">负载均衡</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">3.</span> <span class="toc-text">常见使用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%A8%E5%9F%9F%E9%85%8D%E7%BD%AE"><span class="toc-number">3.1.</span> <span class="toc-text">跨域配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%98%B2%E7%9B%97%E9%93%BE%E9%85%8D%E7%BD%AE"><span class="toc-number">3.2.</span> <span class="toc-text">防盗链配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TODO-OSI%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B"><span class="toc-number">3.3.</span> <span class="toc-text">TODO OSI网络模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTPS%E8%AF%81%E4%B9%A6%E9%85%8D%E7%BD%AE"><span class="toc-number">3.4.</span> <span class="toc-text">HTTPS证书配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nginx%E7%BC%93%E5%AD%98"><span class="toc-number">3.5.</span> <span class="toc-text">nginx缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98"><span class="toc-number">3.5.1.</span> <span class="toc-text">浏览器缓存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E7%BC%93%E5%AD%98"><span class="toc-number">3.5.2.</span> <span class="toc-text">反向代理缓存</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TODO-keepalived"><span class="toc-number">3.6.</span> <span class="toc-text">TODO keepalived</span></a></li></ol></li></ol></div></div></div><header class="post-bg" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">D丶Cheng的博客</a></span><span id="menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 所有文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">Nginx基础</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-01-22T04:00:00.000Z" title="发表于 2021-01-22 12:00:00">2021-01-22</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-12-06T06:02:17.644Z" title="更新于 2022-12-06 14:02:17">2022-12-06</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/nginx/">nginx</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">4.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>16分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><h2 id="yum方式"><a href="#yum方式" class="headerlink" title="yum方式"></a>yum方式</h2><blockquote>
<p>这个比较简单，一步到位</p>
</blockquote>
<h3 id="先安装依赖"><a href="#先安装依赖" class="headerlink" title="先安装依赖"></a>先安装依赖</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install gcc zlib zlib-devel pcre-devel openssl openssl-devel</span><br></pre></td></tr></table></figure>

<h3 id="安装nginx"><a href="#安装nginx" class="headerlink" title="安装nginx"></a>安装nginx</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> yum install nginx <span class="comment"># 安装</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装完毕以后 可以使用如下常用命令</span></span><br><span class="line">nginx -v # 查看版本</span><br><span class="line">nginx -t # 检查语法</span><br><span class="line">nginx -s reload # 重启</span><br><span class="line">nginx -s stop # 暴力关闭</span><br><span class="line">nginx -s quit # 优雅关闭</span><br></pre></td></tr></table></figure>

<h2 id="自行安装方式"><a href="#自行安装方式" class="headerlink" title="自行安装方式"></a>自行安装方式</h2><ol>
<li><p>去官网<a target="_blank" rel="noopener" href="http://nginx.org/%E4%B8%8B%E8%BD%BD%E5%AF%B9%E5%BA%94%E7%9A%84nginx%E5%8C%85%EF%BC%8C%E6%8E%A8%E8%8D%90%E4%BD%BF%E7%94%A8%E7%A8%B3%E5%AE%9A%E7%89%88%E6%9C%AC">http://nginx.org/下载对应的nginx包，推荐使用稳定版本</a></p>
</li>
<li><p>上传nginx到linux系统</p>
</li>
<li><p>安装依赖环境</p>
<ul>
<li>安装gcc环境</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install gcc-c++</span><br></pre></td></tr></table></figure>

<ul>
<li>安装PCRE库,用于解析正则表达式</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y pcre pcre-devel</span><br></pre></td></tr></table></figure>

<ul>
<li>zlib压缩和解压缩依赖</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y zlib zlib-devel</span><br></pre></td></tr></table></figure>

<ul>
<li>SSL安全的加密的套接字协议层,用于HTTP安全传输,也就是https</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y openssl openssl-devel</span><br></pre></td></tr></table></figure>
</li>
<li><p>解压，需要注意，解压后得到的是源码，源码需要编译后才能安装</p>
</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf nginx-1.18.0.tar.gz # 换成自己的版本</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>编译之前，先创建nginx临时目录，如果不创建，在启动nginx的过程中会报错</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /var/temp/nginx -p </span><br></pre></td></tr></table></figure>

<ol start="6">
<li>在nginx目录，输入如下命令进行配置，目的是为了创建makefile文件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure \n --prefix=/usr/local/nginx \n --pid-path=/var/run/nginx/nginx.pid \n --lock-path=/var/lock/nginx.lock \n --error-log-path=/var/log/nginx/error.log \n --http-log-path=/var/log/nginx/access.log \n --with-http_gzip_static_module \n --http-client-body-temp-path=/var/temp/nginx/client \n --http-proxy-temp-path=/var/temp/nginx/proxy \n --http-fastcgi-temp-path=/var/temp/nginx/fastcgi \n --http-uwsgi-temp-path=/var/temp/nginx/uwsgi \n --http-scgi-temp-path=/var/temp/nginx/scgi</span><br></pre></td></tr></table></figure>

<p><strong>注：</strong>\n 代表在命令行中换行，用于提高可读性</p>
<p><strong>配置命令：</strong></p>
<table>
<thead>
<tr>
<th><strong>命令</strong></th>
<th><strong>解释</strong></th>
</tr>
</thead>
<tbody><tr>
<td>–prefix</td>
<td>指定 nginx 安装目录</td>
</tr>
<tr>
<td>–pid-path</td>
<td>指定 nginx 的 pid</td>
</tr>
<tr>
<td>–lock-path</td>
<td>锁定安装文件，防止被恶意篡改或误操作</td>
</tr>
<tr>
<td>–error-path</td>
<td>错误日志</td>
</tr>
<tr>
<td>–http-log-path</td>
<td>http 日志</td>
</tr>
<tr>
<td>-with-http_gzip_static_module</td>
<td>启用 gzip 模块，在线实时压缩输出数据流</td>
</tr>
<tr>
<td>-http-client-body-temp-path</td>
<td>设定客户端请求的临时目录</td>
</tr>
<tr>
<td>-http-proxy-temp-path</td>
<td>设置 http 代理临时目录</td>
</tr>
<tr>
<td>-http-fastcgi-temp-path</td>
<td>设定 fastcgi 临时目录</td>
</tr>
<tr>
<td>-http-uwsgi-temp-path</td>
<td>设定 uwsgi 临时目录</td>
</tr>
<tr>
<td>-http-scgi-temp-path</td>
<td>设定 scgi 临时目录</td>
</tr>
</tbody></table>
<ol start="7">
<li>make 编译</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>安装</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make install</span><br></pre></td></tr></table></figure>

<ol start="9">
<li>进入 sbin 目录启动 Nginx</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./nginx</span><br></pre></td></tr></table></figure>

<p>不管是哪种方式，启动后都可以直接访问(端口默认80)，比如本地就访问127.0.0.1，服务器直接输入ip。<strong>服务器记得开启80端口或防火墙。</strong></p>
<h2 id="安装方式区别"><a href="#安装方式区别" class="headerlink" title="安装方式区别"></a>安装方式区别</h2><p>不做额外配置的话，yml安装方式可以在任何地方执行安装或nginx操作命令，自行安装需要进入对应的目录。例如nginx刷新，操作如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> yum方式，在任意目录下执行如下命令即可</span></span><br><span class="line">nginx -s reload</span><br><span class="line"><span class="meta">#</span><span class="bash"> 自行安装方式，需要两步</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1. 进入nginx的sbin目录,例如安装在了/usr/<span class="built_in">local</span>/nginx下</span></span><br><span class="line">cd /usr/local/nginx/sbin/</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 执行如下命令即可</span></span><br><span class="line">./nginx -s reload</span><br></pre></td></tr></table></figure>

<h2 id="遇到的问题问题"><a href="#遇到的问题问题" class="headerlink" title="遇到的问题问题"></a>遇到的问题问题</h2><ul>
<li>如果出现nginx: [error] open() “/var/run/nginx.pid” failed (2: No such file or directory)</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 执行这个命令就行</span></span><br><span class="line">sudo nginx -c /etc/nginx/nginx.conf</span><br><span class="line"><span class="meta">#</span><span class="bash"> 执行完就可以执行启动或者重启了</span></span><br><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure>

<h1 id="nginx-conf核心配置文件详解"><a href="#nginx-conf核心配置文件详解" class="headerlink" title="nginx.conf核心配置文件详解"></a>nginx.conf核心配置文件详解</h1><blockquote>
<p>nginx.conf一共由3大部分组成：全局块、events块、http块。</p>
</blockquote>
<p><img src="https://cdn.staticaly.com/gh/Chave-Z/picture@master/202208031125115.png" alt="nginx.conf核心配置文件详解"></p>
<p>nginx.conf文件概览：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"># 全局快</span><br><span class="line">------------------------------------------------------------------------------</span><br><span class="line">#user  nobody;</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">#error_log  logs/error.log;</span><br><span class="line">#error_log  logs/error.log  notice;</span><br><span class="line">#error_log  logs/error.log  info;</span><br><span class="line"></span><br><span class="line">#pid        logs/nginx.pid;</span><br><span class="line"></span><br><span class="line">------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"># events块</span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># http块 </span><br><span class="line">http &#123;</span><br><span class="line">------------------------------------------------------------------------------# http全局块</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    #log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">    #                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">    #                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line"></span><br><span class="line">    #access_log  logs/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    #keepalive_timeout  0;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    #gzip  on;        </span><br><span class="line">------------------------------------------------------------------------------    </span><br><span class="line"># server块</span><br><span class="line">server &#123;</span><br><span class="line"># server全局块</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line">        #charset koi8-r;</span><br><span class="line"></span><br><span class="line">        #access_log  logs/host.access.log  main;</span><br><span class="line"></span><br><span class="line"># location块</span><br><span class="line">        location / &#123;</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        #error_page  404              /404.html;</span><br><span class="line"></span><br><span class="line">        # redirect server error pages to the static page /50x.html</span><br><span class="line">        #</span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        # proxy the PHP scripts to Apache listening on 127.0.0.1:80</span><br><span class="line">        #</span><br><span class="line">        #location ~ \.php$ &#123;</span><br><span class="line">        #    proxy_pass   http://127.0.0.1;</span><br><span class="line">        #&#125;</span><br><span class="line"></span><br><span class="line">        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span><br><span class="line">        #</span><br><span class="line">        #location ~ \.php$ &#123;</span><br><span class="line">        #    root           html;</span><br><span class="line">        #    fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">        #    fastcgi_index  index.php;</span><br><span class="line">        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span><br><span class="line">        #    include        fastcgi_params;</span><br><span class="line">        #&#125;</span><br><span class="line"></span><br><span class="line">        # deny access to .htaccess files, if Apache&#x27;s document root</span><br><span class="line">        # concurs with nginx&#x27;s one</span><br><span class="line">        #</span><br><span class="line">        #location ~ /\.ht &#123;</span><br><span class="line">        #    deny  all;</span><br><span class="line">        #&#125;</span><br><span class="line">&#125;</span><br><span class="line">	</span><br><span class="line"># 可以配置多个server块	</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="全局块"><a href="#全局块" class="headerlink" title="全局块"></a>全局块</h2><h3 id="user"><a href="#user" class="headerlink" title="user"></a>user</h3><p>​        设置worker进程的用户，指的linux中的用户，会涉及到nginx操作目录或文件的一些权限，默认为 nobody </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user root; </span><br></pre></td></tr></table></figure>

<h3 id="worker-processes"><a href="#worker-processes" class="headerlink" title="worker_processes"></a>worker_processes</h3><p>​        worker进程工作数设置，一般来说CPU有几个，就设置几个，或者设置为N-1也行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">worker_processes 1; </span><br></pre></td></tr></table></figure>

<h3 id="日志级别"><a href="#日志级别" class="headerlink" title="日志级别"></a>日志级别</h3><p>​        nginx 日志级别<code>debug | info | notice | warn | error | crit | alert | emerg</code>，错误级别从左到右越来越大。</p>
<h3 id="pid"><a href="#pid" class="headerlink" title="pid"></a>pid</h3><p>​        设置nginx进程 pid</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pid logs/nginx.pid; </span><br></pre></td></tr></table></figure>

<h2 id="events模块"><a href="#events模块" class="headerlink" title="events模块"></a>events模块</h2><p>​        设置工作模式</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">events &#123; </span><br><span class="line">	# 默认使用epoll </span><br><span class="line">	use epoll; </span><br><span class="line">	# 每个worker允许连接的客户端最大连接数 </span><br><span class="line">	worker_connections 10240; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h2 id="http指令块"><a href="#http指令块" class="headerlink" title="http指令块"></a>http指令块</h2><p>​        http 是指令块，针对http网络传输的一些指令配置</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http &#123; </span><br><span class="line"></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h3 id="http直属配置"><a href="#http直属配置" class="headerlink" title="http直属配置"></a>http直属配置</h3><h4 id="include"><a href="#include" class="headerlink" title="include"></a>include</h4><p>​        include 引入外部配置，提高可读性，避免单个配置文件过大</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include mime.types; </span><br></pre></td></tr></table></figure>

<h4 id="log-format"><a href="#log-format" class="headerlink" title="log_format"></a>log_format</h4><p>​        <strong>设定日志格式</strong>， main 为定义的格式名称，如此 access_log 就可以直接使用这个变量了</p>
<p><img src="https://cdn.staticaly.com/gh/Chave-Z/picture@master/data/image-20210128154631809.png" alt="image-20210128154631809"></p>
<table>
<thead>
<tr>
<th><strong>参数</strong></th>
<th><strong>说明</strong></th>
<th><strong>示例</strong></th>
</tr>
</thead>
<tbody><tr>
<td>$remote_addr</td>
<td>客户端地址</td>
<td>219.227.111.255</td>
</tr>
<tr>
<td>$remote_user</td>
<td>客户端用户名称</td>
<td>—</td>
</tr>
<tr>
<td>$time_local</td>
<td>访问时间和时区</td>
<td>18/Jul/2020:17:00:01 +0800</td>
</tr>
<tr>
<td>$request</td>
<td>请求的URI和HTTP协议</td>
<td>“GET /article-10000.html HTTP/1.1”</td>
</tr>
<tr>
<td>$http_host</td>
<td>请求地址，即浏览器中你输入的地址（IP或域名）</td>
<td><a target="_blank" rel="noopener" href="http://www.ha97.com/">www.ha97.com</a> 198.98.120.87</td>
</tr>
<tr>
<td>$status</td>
<td>HTTP请求状态</td>
<td>200</td>
</tr>
<tr>
<td>$upstream_status</td>
<td>upstream状态</td>
<td>200</td>
</tr>
<tr>
<td>$body_bytes_sent</td>
<td>发送给客户端文件内容大小</td>
<td>1547</td>
</tr>
<tr>
<td>$http_referer</td>
<td>url跳转来源</td>
<td><a target="_blank" rel="noopener" href="http://www.ha97.com/tag/https">https</a>://www.<a target="_blank" rel="noopener" href="http://www.ha97.com/category/google">google</a>.com/</td>
</tr>
<tr>
<td>$http_user_agent</td>
<td>用户终端浏览器等信息</td>
<td>“Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0; SV1; GTB7.0; .NET4.0C;</td>
</tr>
<tr>
<td>$ssl_protocol</td>
<td>SSL协议版本</td>
<td>TLSv1</td>
</tr>
<tr>
<td>$ssl_cipher</td>
<td>交换数据中的算法</td>
<td>RC4-SHA</td>
</tr>
<tr>
<td>$upstream_addr</td>
<td>后台upstream的地址，即真正提供服务的主机地址</td>
<td>10.36.10.80:80</td>
</tr>
<tr>
<td>$request_time</td>
<td>整个请求的总时间</td>
<td>0.165</td>
</tr>
<tr>
<td>$upstream_response_time</td>
<td>请求过程中，upstream响应时间</td>
<td>0.002</td>
</tr>
</tbody></table>
<h4 id="sendfile和tcp-nopush"><a href="#sendfile和tcp-nopush" class="headerlink" title="sendfile和tcp_nopush"></a>sendfile和tcp_nopush</h4><p>​        <strong>sendfile使用高效文件传输，提升传输性能 。启用后</strong>才能使用 <strong>tcp_nopush</strong> ，是指<strong>当数据表累积一定大小后才发送，提高了效率。</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sendfile on; </span><br><span class="line">tcp_nopush on;</span><br></pre></td></tr></table></figure>

<h4 id="keepalive-timeout"><a href="#keepalive-timeout" class="headerlink" title="keepalive_timeout"></a>keepalive_timeout</h4><p>​        <strong>keepalive_timeout</strong> 设置客户端与服务端请求的超时时间，保证客户端多次请求的时候不会重复建立新的连接，节约资源损耗。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> keepalive_timeout 0; </span></span><br><span class="line">keepalive_timeout 65;</span><br></pre></td></tr></table></figure>

<h4 id="gzip"><a href="#gzip" class="headerlink" title="gzip"></a>gzip</h4><p>​        gzip 启用压缩，<code>html/js/css</code>压缩后传输会 更快</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gzip on;</span><br></pre></td></tr></table></figure>

<h3 id="server模块"><a href="#server模块" class="headerlink" title="server模块"></a>server模块</h3><p><strong>server</strong>可以在其对应的<strong>http</strong>指令块中设置多个虚拟主机</p>
<ul>
<li>listen：监听端口</li>
<li>server_ name：  可以填写localhost、ip、 域名</li>
<li>location： 请求路由映射，匹配拦截</li>
<li>root： 请求位置</li>
<li>index： 首页设置</li>
<li>alias： 路径别名</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line">  server_name localhost;</span><br><span class="line">  location / &#123;</span><br><span class="line">    root html;</span><br><span class="line">    index index.html index.htm;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="location模块"><a href="#location模块" class="headerlink" title="location模块"></a>location模块</h4><h5 id="root和alias的区别"><a href="#root和alias的区别" class="headerlink" title="root和alias的区别"></a>root和alias的区别</h5><ul>
<li><strong>root的真实的路径是root值+location值，alias会去掉location的值，直接访问alias的路径对应的文件</strong></li>
<li>alias 只能作用在location中，而root可以存在server、http和location中。</li>
<li><strong>alias 后面必须要用 “/” 结束</strong>，否则会找不到文件，而 root 则对 ”/” 可有可无。</li>
</ul>
<p>例如：当用户请求： <code>http://ip:port/static/test.gif </code>这个地址时，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location &#x2F;static&#x2F; &#123;</span><br><span class="line">  root &#x2F;file&#x2F;img;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实际访问：<code> /file/img/static/test.gif</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location /static/ &#123;</span><br><span class="line">  alias /file/img;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实际访问：<code> /file/img/test.gif</code></p>
<h5 id="location的匹配规则"><a href="#location的匹配规则" class="headerlink" title="location的匹配规则"></a>location的匹配规则</h5><table>
<thead>
<tr>
<th>标识符</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>=</td>
<td><strong>精确匹配：</strong>用于标准uri前，要求请求字符串和uri严格匹配。如果匹配成功就停止匹配，立即执行该location里面的请求。</td>
</tr>
<tr>
<td>~</td>
<td><strong>正则匹配：</strong>用于正则uri前，表示uri里面包含正则，并且区分大小写。</td>
</tr>
<tr>
<td>~*</td>
<td><strong>正则匹配：</strong>用于正则uri前，表示uri里面包含正则，不区分大小写。</td>
</tr>
<tr>
<td>^~</td>
<td><strong>非正则匹配；</strong>用于标准uri前，nginx服务器匹配到前缀最多的uri后就结束，该模式匹配成功后，不会使用正则匹配。</td>
</tr>
<tr>
<td>空格</td>
<td><strong>普通匹配（最长字符匹配）；</strong>与location顺序无关，是按照匹配的长短来取匹配结果。若完全匹配，就停止匹配。</td>
</tr>
</tbody></table>
<ul>
<li>空格 ：默认匹配，普通匹配</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">	root /home;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>= ：精确匹配</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location = /file/img/face1.png &#123; </span><br><span class="line">	root /home;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>~* ：匹配正则表达式，<strong>不区分大小写</strong></li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 符合图片的显示 </span><br><span class="line">location ~ \.(GIF|jpg|png|jpeg) &#123; </span><br><span class="line">	root /home; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>~ ：匹配正则表达式，<strong>区分大小写</strong></li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#GIF必须大写才能匹配到 </span><br><span class="line">location ~ \.(GIF|jpg|png|jpeg) &#123; </span><br><span class="line">	root /home; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>^~ ：以某个字符路径开头</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location ^~ /static/img &#123; </span><br><span class="line">	root /home; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="upstream"><a href="#upstream" class="headerlink" title="upstream"></a>upstream</h4><h5 id="max-conns"><a href="#max-conns" class="headerlink" title="max_conns"></a><strong>max_conns</strong></h5><p><strong>限制每台server的连接数，用于保护避免过载，可起到限流作用。</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># worker进程设置1个，便于测试观察成功的连接数 </span><br><span class="line">worker_processes 1; </span><br><span class="line">upstream tomcats &#123; </span><br><span class="line">	server 192.168.1.200:8080 max_conns=2; </span><br><span class="line">	server 192.168.1.201:8080 max_conns=2; </span><br><span class="line">	server 192.168.1.202:8080 max_conns=2; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="slow-start-付费功能"><a href="#slow-start-付费功能" class="headerlink" title="slow_start(付费功能)"></a><strong>slow_start(付费功能)</strong></h5><p>让服务缓慢启动增加权重</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream tomcats &#123; </span><br><span class="line">	server 192.168.1.200:8080 weight=6 slow_start=60s; </span><br><span class="line">	server 192.168.1.201:8080 weight=2; </span><br><span class="line">	server 192.168.1.202:8080 weight=2; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注：</strong></p>
<p>该参数不能使用在 hash 和 random load balancing 中。</p>
<p>如果在 upstream 中只有一台 server，则该参数失效。</p>
<h5 id="down"><a href="#down" class="headerlink" title="down"></a><strong>down</strong></h5><p><strong>down 用于标记服务节点不可用</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream tomcats &#123; </span><br><span class="line">	server 192.168.1.200:8080 down; </span><br><span class="line">	server 192.168.1.201:8080 weight=1; </span><br><span class="line">	server 192.168.1.202:8080 weight=1; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="backup"><a href="#backup" class="headerlink" title="backup"></a><strong>backup</strong></h5><p>backup 表示当前服务器节点是备用机，只有在其他的服务器都宕机以后，自己才会加入到集群中，被用户访问到：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream tomcats &#123; </span><br><span class="line">  server 192.168.1.200:8080 backup; </span><br><span class="line">  server 192.168.1.201:8080 weight=1; </span><br><span class="line">  server 192.168.1.202:8080 weight=1; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p><strong>注：</strong> </p>
<p>backup 参数不能使用在 hash 和 random load balancing 中。</p>
<ul>
<li><strong>max_fails和fail_timeout</strong></li>
</ul>
<p><strong>max_fails：表示失败几次，则标记server已宕机，剔出上游服务。</strong></p>
<p><strong>fail_timeout：表示失败的重试时间。</strong></p>
<p>如进行如下设置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">max_fails=<span class="number">2</span> fail_timeout=<span class="number">15</span>s</span><br></pre></td></tr></table></figure>

<p>则代表在15秒内请求某一server失败达到2次后，则认为该server已经挂了或者宕机了，随后再过15秒，这15秒内不会有新的请求到达刚刚挂掉的节点上，而是会请求到正常运作的server上，15秒后会再有新请求尝试连接挂掉的server，如果还是失败，重复上一过程，直到恢复。</p>
<h5 id="keepalive"><a href="#keepalive" class="headerlink" title="keepalive"></a>keepalive</h5><blockquote>
<p>keepalive ： 设置长连接处理的数量</p>
<p>proxy_http_version ：设置长连接http版本为1.1</p>
<p>proxy_set_header ：清除connection header 信息</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">upstream tomcats &#123; </span><br><span class="line">  server 192.168.1.200:8080;</span><br><span class="line">  keepalive 32; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">  listen 80; </span><br><span class="line">  server_name www.tomcats.com;</span><br><span class="line">  </span><br><span class="line">  location / &#123; </span><br><span class="line">    proxy_pass http://tomcats; </span><br><span class="line">    proxy_http_version 1.1; </span><br><span class="line">    proxy_set_header Connection &quot;&quot;; </span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h5><ul>
<li><strong>weight</strong></li>
</ul>
<p>指定轮询几率，weight和访问比率成正比，用于后端服务器性能不均的情况。</p>
<ul>
<li><strong>ip_hash</strong></li>
</ul>
<p><code>ip_hash</code>可以<strong>保证用户在ip没有更改的情况下访问固定的服务器</strong>：hash(ip) % node_counts(服务器节点数量) = index</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">upstream tomcats &#123;</span><br><span class="line">  ip_hash;</span><br><span class="line">	server 192.168.1.200:8080; </span><br><span class="line">	server 192.168.1.201:8080 down; </span><br><span class="line">	server 192.168.1.202:8080; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注：</strong> </p>
<ol>
<li>在nginx版本1.3.1之前，不能在ip_hash中使用权重（weight）。</li>
<li>ip_hash不能与backup同时使用。</li>
<li>此策略适合有状态服务，比如session。</li>
<li>当有服务器需要剔除，必须手动down掉。</li>
</ol>
<ul>
<li><strong>url_hash（第三方）</strong></li>
</ul>
<p>​        按访问url的hash结果来分配请求，使每个url定向到同一个后端服务器，要配合缓存命中来使用。同一个资源多次请求，可能会到达不同的服务器上，导致不必要的多次下载，缓存命中率不高，以及一些资源时间的浪费。而使用url_hash，可以使得同一个url（也就是同一个资源请求）会到达同一台服务器，一旦缓存住了资源，再此收到请求，就可以从缓存中读取。</p>
<ul>
<li><strong>least_conn</strong></li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">upstream tomcats &#123; </span><br><span class="line">  # url_hash;</span><br><span class="line">  hash $request_uri;</span><br><span class="line">  # 请求过来之后映射到请求量最少的服务器,此适合请求处理时间长短不一造成服务器过载的情况。</span><br><span class="line">  # least_conn</span><br><span class="line">	server 192.168.1.200:8080; </span><br><span class="line">	server 192.168.1.201:8080; </span><br><span class="line">	server 192.168.1.202:8080; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">  listen 80; </span><br><span class="line">  server_name www.tomcats.com;</span><br><span class="line">  </span><br><span class="line">  location / &#123; </span><br><span class="line">    proxy_pass http://tomcats; </span><br><span class="line">    proxy_http_version 1.1; </span><br><span class="line">    proxy_set_header Connection &quot;&quot;; </span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>todo 一致性hash模块</strong></li>
</ul>
<h1 id="常见使用场景"><a href="#常见使用场景" class="headerlink" title="常见使用场景"></a>常见使用场景</h1><h2 id="跨域配置"><a href="#跨域配置" class="headerlink" title="跨域配置"></a>跨域配置</h2><p>​        可以在server或者location模块加上如下配置（方式不唯一）</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># 方式一：在server模块添加</span><br><span class="line">server&#123;</span><br><span class="line">  ……</span><br><span class="line">  #允许跨域请求的域，*代表所有 </span><br><span class="line">  add_header &#x27;Access-Control-Allow-Origin&#x27; *; </span><br><span class="line">  #允许带上cookie请求 </span><br><span class="line">  add_header &#x27;Access-Control-Allow-Credentials&#x27; &#x27;true&#x27;; </span><br><span class="line">  #允许请求的方法，比如 GET/POST/PUT/DELETE </span><br><span class="line">  add_header &#x27;Access-Control-Allow-Methods&#x27; *; </span><br><span class="line">  #允许请求的header add_header </span><br><span class="line">  &#x27;Access-Control-Allow-Headers&#x27; *;</span><br><span class="line">  ……</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 方式二：在location模块添加</span><br><span class="line">location /&#123;</span><br><span class="line">  ……</span><br><span class="line">  #允许跨域请求的域，*代表所有 </span><br><span class="line">  add_header &#x27;Access-Control-Allow-Origin&#x27; *; </span><br><span class="line">  #允许带上cookie请求 </span><br><span class="line">  add_header &#x27;Access-Control-Allow-Credentials&#x27; &#x27;true&#x27;; </span><br><span class="line">  #允许请求的方法，比如 GET/POST/PUT/DELETE </span><br><span class="line">  add_header &#x27;Access-Control-Allow-Methods&#x27; *; </span><br><span class="line">  #允许请求的header add_header </span><br><span class="line">  &#x27;Access-Control-Allow-Headers&#x27; *;</span><br><span class="line">  ……</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="防盗链配置"><a href="#防盗链配置" class="headerlink" title="防盗链配置"></a>防盗链配置</h2><ul>
<li>利用Referer头来判断是否是合法请求</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">location ~* \.(gif|jpg|png|swf|flv)$ &#123; </span><br><span class="line">  valid_referers none blocked www.xxx.com xxx.com ; </span><br><span class="line">  if ($invalid_referer) &#123; </span><br><span class="line">    #return 403;  #直接提示拒绝访问</span><br><span class="line">    #return 404;  #直接提示找不到资源</span><br><span class="line">    rewrite ^/ http://www.xxx.com/xxx.jpg;  #返回特定的图片</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br><span class="line">#none意为不存在的Referer头。</span><br><span class="line">#blocked意为根据防火墙伪装Referer头，如：“Referer: XXXXXXX”。</span><br></pre></td></tr></table></figure>

<ul>
<li>利用ngx_http_accesskey_module模块，有兴趣可以自己去了解一下</li>
</ul>
<h2 id="TODO-OSI网络模型"><a href="#TODO-OSI网络模型" class="headerlink" title="TODO OSI网络模型"></a>TODO OSI网络模型</h2><h2 id="HTTPS证书配置"><a href="#HTTPS证书配置" class="headerlink" title="HTTPS证书配置"></a>HTTPS证书配置</h2><ul>
<li>安装ssl模块**(yum安装的不用另外安装)**</li>
</ul>
<p>如果是手动安装的，可能没有这个模块，参考下面的就行：</p>
<p>先进入安装目录，然后执行下面的语句</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">./configure \ </span><br><span class="line">--prefix=/usr/local/nginx \ </span><br><span class="line">--pid-path=/var/run/nginx/nginx.pid \ </span><br><span class="line">--lock-path=/var/lock/nginx.lock \ </span><br><span class="line">--error-log-path=/var/log/nginx/error.log \ </span><br><span class="line">--http-log-path=/var/log/nginx/access.log \ </span><br><span class="line">--with-http_gzip_static_module \ </span><br><span class="line">--http-client-body-temp-path=/var/temp/nginx/client \ </span><br><span class="line">--http-proxy-temp-path=/var/temp/nginx/proxy \ </span><br><span class="line">--http-fastcgi-temp-path=/var/temp/nginx/fastcgi \ </span><br><span class="line">--http-uwsgi-temp-path=/var/temp/nginx/uwsgi \ </span><br><span class="line">--http-scgi-temp-path=/var/temp/nginx/scgi \ </span><br><span class="line">--with-http_ssl_module</span><br></pre></td></tr></table></figure>

<p>编译和安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">make </span><br><span class="line"><span class="meta">#</span><span class="bash"> 然后</span></span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>配置HTTPS</strong></li>
</ul>
<p>把ssl证书 *.crt 和 私钥 *.key 拷贝到自己nginx的conf目录中，例如：/usr/local/nginx/conf，然后新增 server 监听 443 端口：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">server &#123; </span><br><span class="line">    listen 443; </span><br><span class="line">    server_name www.imoocdsp.com; </span><br><span class="line">    # 开启ssl </span><br><span class="line">    ssl on; </span><br><span class="line">    # 配置ssl证书 </span><br><span class="line">    ssl_certificate xxxxx.crt; </span><br><span class="line">    # 配置证书秘钥 </span><br><span class="line">    ssl_certificate_key xxxx.key; </span><br><span class="line">    # ssl会话cache </span><br><span class="line">    ssl_session_cache shared:SSL:1m; </span><br><span class="line">    # ssl会话超时时间 </span><br><span class="line">    ssl_session_timeout 5m; </span><br><span class="line">    # 配置加密套件，写法遵循 openssl 标准 </span><br><span class="line">    ssl_protocols TLSv1 TLSv1.1 TLSv1.2; </span><br><span class="line">    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE; </span><br><span class="line">    ssl_prefer_server_ciphers on; </span><br><span class="line">    location / &#123; </span><br><span class="line">    		proxy_pass http://tomcats/;</span><br><span class="line">    		index index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;    </span><br></pre></td></tr></table></figure>

<p><strong>注：</strong>xxxxx.crt和xxxx.key换成自己的</p>
<ul>
<li>安装完以后 重启一下nginx即可</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./nginx -s reload</span><br></pre></td></tr></table></figure>

<h2 id="nginx缓存"><a href="#nginx缓存" class="headerlink" title="nginx缓存"></a>nginx缓存</h2><h3 id="浏览器缓存"><a href="#浏览器缓存" class="headerlink" title="浏览器缓存"></a>浏览器缓存</h3><p>​        nginx缓存的设置可以提高网站性能，对于某些网站的图片，一旦发布，改动的可能是非常小的，为了减小对服务器请求的压力，提高用户浏览速度，我们可以通过设置nginx中的expires，让用户访问一次后，将图片缓存在用户的浏览器中，且时间比较长的缓存。</p>
<p><img src="https://cdn.staticaly.com/gh/Chave-Z/picture@master/data/image-20210205161023363.png" alt="image-20210205161023363"></p>
<p><strong>Cache-control：</strong>用于控制HTTP缓存（在HTTP/1.0中可能部分没实现，仅仅实现了 Pragma: no-cache）<br><strong>Expires：</strong>表示到期时间，允许客户端在这个时间之前不去检查（发请求），等同max-age的效果。但是<strong>如果同时存在，则被Cache-Control的max-age覆盖。</strong></p>
<p>​        nginx可以在location或者if中使用，例如：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 语法：expires [time|epoch|max|off]，默认值：off</span><br><span class="line">location /images&#123;</span><br><span class="line">	....</span><br><span class="line">	# expries 10s; 持续10秒</span><br><span class="line">	# expries 10h; 持续10小时</span><br><span class="line">	# expries 10d; 持续10天</span><br><span class="line">  # expries @12h30m;  当前时间超过12:30就在第二天12:30过期，否则就是今天12:30过期</span><br><span class="line">	# expries off; </span><br><span class="line">  # expries -1; 永不过期</span><br><span class="line">  # expries epoch; 过期时间Thu, 01 Jan 1970 00:00:01 GMT</span><br><span class="line">	expries max; # 过期时间是 Thu, 31 Dec 2037 23:55:55 GMT，Cache-Control是十年</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​        当nginx设置了expires后，例如设置为：expires 10h; 那么，所在的location或if的内容，用户在10小时内请求的时候，都只会访问浏览器中的缓存，而不会去请求nginx。</p>
<p><strong>注：这种缓存方式只能在用户不对浏览器强制刷新的情况下生效，如果用户通过url来进行访问，是可以访问到缓存的。</strong></p>
<h3 id="反向代理缓存"><a href="#反向代理缓存" class="headerlink" title="反向代理缓存"></a>反向代理缓存</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># proxy_cache_path 设置缓存目录 </span><br><span class="line"># keys_zone 设置共享内存以及占用空间大小 </span><br><span class="line"># max_size 设置缓存大小 </span><br><span class="line"># inactive 超过此时间则被清理 </span><br><span class="line"># use_temp_path 临时目录，使用后会影响nginx性能 </span><br><span class="line"></span><br><span class="line">proxy_cache_path /usr/local/nginx/upstream_cache keys_zone=mycache:5m max_size=1g inactive=1m use_temp_path= </span><br><span class="line"></span><br><span class="line">location / &#123; </span><br><span class="line">		proxy_pass http://test; </span><br><span class="line">		# 启用缓存，和keys_zone一致 </span><br><span class="line">		proxy_cache mycache; </span><br><span class="line">		# 针对200和304状态码缓存时间为8小时 </span><br><span class="line">		proxy_cache_valid 200 304 8h; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="TODO-keepalived"><a href="#TODO-keepalived" class="headerlink" title="TODO keepalived"></a>TODO keepalived</h2></div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">D丶Cheng</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://chave-z.github.io/posts/a477be03.html">https://chave-z.github.io/posts/a477be03.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://chave-z.github.io" target="_blank">D丶Cheng的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/nginx/">nginx</a></div><div class="post_share"><div class="social-share" data-image="/null" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/ddc0e61e.html"><img class="prev-cover" src="/null" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">一文搞定Nacos</div></div></a></div><div class="next-post pull-right"><a href="/posts/b0da255.html"><img class="next-cover" src="/null" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">调优工具详解</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/1394dd67.html" title="location及rewrite配置详解"><img class="cover" src="/null"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-07-30</div><div class="title">location及rewrite配置详解</div></div></a></div></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2022 By D丶Cheng</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="/js/search/local-search.js"></script><script>var endLoading = function () {
  document.body.style.overflow = 'auto';
  document.getElementById('loading-box').classList.add("loaded")
}
window.addEventListener('load',endLoading)</script><div class="js-pjax"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="/js/third-party/canvas-nest.js"></script></div></body></html>